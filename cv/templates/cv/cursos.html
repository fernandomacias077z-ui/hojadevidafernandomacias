{% load static %}

<div class="d-flex align-items-center mb-5">
    <div class="me-3 p-3 border border-secondary bg-black">
        <i class="bi bi-journals text-warning fs-3"></i>
    </div>
    <div>
        <h2 class="h3 fw-bold text-white mb-0 font-monospace">KNOWLEDGE_BASE</h2>
        <p class="text-dim small mb-0 font-monospace">Technical manuals & resources</p>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for curso in cursos %}
    <div class="col">
        <div class="card h-100 bg-black border-secondary p-0 hover-effect">
            
            <div class="card-header bg-dark border-bottom border-secondary py-1 px-3 d-flex justify-content-between">
                <span class="text-dim font-monospace small">DOC_ID: {{ curso.id }}0X</span>
                <span class="text-warning font-monospace small">{{ curso.fecha|date:"M.Y" }}</span>
            </div>

            <div class="card-body p-4 d-flex flex-column">
                <div class="mb-3 text-center p-3 border border-dark bg-dark bg-opacity-10 cursor-pointer" onclick="abrirModalCurso('{{ curso.pdf_archivo.url }}', '{{ curso.titulo }}')">
                     <i class="bi bi-file-earmark-richtext text-dim fs-1"></i>
                     <div class="small text-neon mt-2 font-monospace">[ PREVIEW_FILE ]</div>
                </div>

                <h5 class="fw-bold text-white mb-2 font-monospace">{{ curso.titulo }}</h5>
                <p class="text-secondary small flex-grow-1 mb-3" style="font-family: 'JetBrains Mono';">
                    {{ curso.descripcion|truncatewords:20 }}
                </p>
                
                <div class="mt-auto d-grid gap-2">
                    <button type="button" class="btn btn-sm btn-outline-light rounded-0" onclick="abrirModalCurso('{{ curso.pdf_archivo.url }}', '{{ curso.titulo }}')">
                        <i class="bi bi-eye me-2"></i>READ
                    </button>
                    <a href="{{ curso.pdf_archivo.url }}" download class="btn btn-sm btn-primary rounded-0">
                        <i class="bi bi-download me-2"></i>DOWNLOAD
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert border border-secondary bg-transparent text-dim text-center py-5 font-monospace">
            NO MANUALS UPLOADED TO SERVER.
        </div>
    </div>
    {% endfor %}
</div>

<div class="modal fade" id="cursoPdfModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" style="height: 90vh;">
        <div class="modal-content bg-black border-secondary h-100">
            <div class="modal-header border-bottom border-dark py-2">
                <div class="d-flex align-items-center">
                    <span class="text-warning me-2 font-monospace">[PDF_READER]</span>
                    <span class="text-white small font-monospace" id="cursoModalTitle">Loading...</span>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0 bg-dark position-relative">
                <iframe id="cursoPdfFrame" class="w-100 h-100 border-0" style="filter: invert(0.9) hue-rotate(180deg);"></iframe>
            </div>
        </div>
    </div>
</div>

<script>
    function abrirModalCurso(urlPdf, titulo) {
        document.getElementById('cursoPdfFrame').src = urlPdf;
        document.getElementById('cursoModalTitle').textContent = titulo;
        new bootstrap.Modal(document.getElementById('cursoPdfModal')).show();
    }
    document.getElementById('cursoPdfModal').addEventListener('hidden.bs.modal', function () {
        document.getElementById('cursoPdfFrame').src = '';
    });
</script>